@echo off
if "%1" == "h" goto begin
start mshta vbscript:createobject("wscript.shell").run("""%~nx0"" h",0)(window.close)&&exit
:begin

title WinFormsAppCollect.exe Modbus采集客户端进程监控器[系统保护]
color 0A
set "exePath=E:\C#\WinFormsAppCollect\bin\Debug\WinFormsAppCollect.exe"
set checkInterval=30

:: 防止多实例
tasklist /fi "imagename eq cmd.exe" | find /i "%~nx0" > nul
if %errorlevel% == 0 exit

:: 主循环
:monitor
tasklist /fi "imagename eq WinFormsAppCollect.exe" | find /i "WinFormsAppCollect.exe" > nul
if %errorlevel% == 0 (
    echo %date% %time% - 运行中...
    timeout /t %checkInterval% > nul
    goto monitor
) else (
    echo %date% %time% - 进程结束，重启中...
    start "" "%exePath%"
    timeout /t 5 > nul
    goto monitor
)